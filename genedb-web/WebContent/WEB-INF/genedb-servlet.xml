<?xml version="1.0" encoding="UTF-8" ?>
<beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:util="http://www.springframework.org/schema/util"
    xmlns:context="http://www.springframework.org/schema/context"
    xsi:schemaLocation="
  http://www.springframework.org/schema/beans
  http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
  http://www.springframework.org/schema/util
  http://www.springframework.org/schema/util/spring-util-2.5.xsd
  http://www.springframework.org/schema/context
  http://www.springframework.org/schema/context/spring-context-2.5.xsd"
    default-init-method="postConstruction">

  <!-- ========================= MESSAGE SOURCE DEFINITION ========================= -->

    <context:component-scan base-package="org.gmod.schema.mapped, org.genedb.querying.core, org.genedb.querying.tmpquery" />
    <context:spring-configured/>
    <context:mbean-export/>

  <!--
    - Message source for this context, loaded from localized "messages_xx" files.
    - Could also reside in the root application context, as it is generic,
    - but is currently just used within PetClinic's web tier.
    -->
  <bean id="messageSource"
    class="org.springframework.context.support.ResourceBundleMessageSource">
        <property name="basenames">
            <list>
                <value>exceptions</value>
                <value>ValidatorMessages</value>
            </list>
        </property>
    </bean>

  <bean id="propertyConfigurer" class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
        <property name="location" value="classpath:project.properties" />
    </bean>

    <bean name="proteinLengthQuery" class="org.genedb.querying.tmpquery.ProteinLengthQuery" scope="prototype" />
    <bean name="proteinMassQuery" class="org.genedb.querying.tmpquery.ProteinMassQuery" scope="prototype"  />
    <bean name="geneTypeQuery" class="org.genedb.querying.tmpquery.GeneTypeQuery" scope="prototype" />
    <bean name="advancedQuery" class="org.genedb.querying.tmpquery.AdvancedQuery"  scope="prototype" />
    <bean name="nameProductQuery" class="org.genedb.querying.tmpquery.NameProductQuery" scope="prototype" />
    <bean name="controlledCurationQuery" class="org.genedb.querying.tmpquery.ControlledCurationQuery" scope="prototype" />
    <bean name="dateQuery" class="org.genedb.querying.tmpquery.DateQuery" scope="prototype" />
    <bean name="geneLocationQuery" class="org.genedb.querying.tmpquery.GeneLocationQuery" scope="prototype" />
    <bean name="annotationStatusQuery" class="org.genedb.querying.tmpquery.AnnotationStatusQuery" scope="prototype" />
    <bean name="proteinTargetingSeqQuery" class="org.genedb.querying.tmpquery.ProteinTargetingSeqQuery" scope="prototype" />
    <bean name="proteinNumTMQuery" class="org.genedb.querying.tmpquery.ProteinNumTMQuery" scope="prototype" />
    <bean name="productQuery" class="org.genedb.querying.tmpquery.ProductQuery" scope="prototype" />
    <bean name="simpleNameQuery" class="org.genedb.querying.tmpquery.SimpleNameQuery" scope="prototype" />
    <bean name="goQuery" class="org.genedb.querying.tmpquery.GoQuery" scope="prototype" />
    <bean name="ecQuery" class="org.genedb.querying.tmpquery.EcQuery" scope="prototype" />
    <bean name="pfamQuery" class="org.genedb.querying.tmpquery.PfamQuery" scope="prototype" />
    <bean name="curationQuery" class="org.genedb.querying.tmpquery.CurationQuery" scope="prototype" />
    <bean name="idsToGeneSummaryQuery" class="org.genedb.querying.tmpquery.IdsToGeneSummaryQuery" scope="prototype" />
    <bean name="quickSearchQuery" class="org.genedb.querying.tmpquery.QuickSearchQuery" scope="prototype" />

    <bean name="queryFactory" class="org.genedb.querying.core.QueryFactory" />

    <!-- ========================= MAPPING DEFINITIONS ========================= -->


    <bean name="berkeleyReadOnlyMapFactory" class="org.genedb.web.mvc.model.BerkeleyMapFactory">
        <property name="rootDirectory" value="${cacheDirectory}"/>
        <property name="readOnly" value="true" />
    </bean>


    <bean name="berkeleyReadWriteTempMapFactory" class="org.genedb.web.mvc.model.BerkeleyMapFactory">
        <property name="rootDirectory" value="/tmp"/>
        <property name="readOnly" value="false" />
    </bean>



    <bean name="diagramCache" class="org.genedb.web.gui.BdbDiagramCache">
        <property name="berkeleyMapFactory" ref="berkeleyReadOnlyMapFactory" />
    </bean>

    <bean id="goProcessBrowse"
        class="org.genedb.web.mvc.controller.BrowseBean">
        <property name="cvDao" ref="cvDao" />
        <property name="sequenceDao" ref="sequenceDao" />
        <property name="cvNames">
            <list>
                <value>biological_process</value>
                <value>cellular_component</value>
                <value>molecular_function</value>
                <value>RILEY</value>
                <value>genedb_products</value>
                <value>CC_genedb_controlledcuration</value>
                <!-- <value>UNIPROT_KEYWORDS</value> -->
            </list>
        </property>
    </bean>

    <bean id="nameBrowse"
        class="org.genedb.web.mvc.controller.BrowseBeanName">
        <property name="cvDao" ref="cvDao" />
        <property name="sequenceDao" ref="sequenceDao" />
        <property name="cvTerm" value="gene" />
    </bean>

    <!--
      - This bean provides explicit View mappings in a resource bundle instead of the
      - default InternalResourceViewResolver. It fetches the view mappings from
      - localized "views_xx" classpath files, i.e. "/WEB-INF/classes/views.properties"
      - or "/WEB-INF/classes/views_de.properties".
      -
      - Symbolic view names returned by Controllers will be resolved by this bean
      - using the respective properties file, which defines arbitrary mappings between
      - view names and resources.
      -->
    <bean id="checkingViewResolver"
        class="org.genedb.web.mvc.controller.FileCheckingInternalResourceViewResolver"
        init-method="postConstruction">
        <property name="viewClass"
            value="org.springframework.web.servlet.view.JstlView" />
        <property name="prefix" value="/WEB-INF/jsp/" />
        <property name="suffix" value=".jsp" />
        <property name="order" value="3" />
    </bean>

    <bean id="freemarkerConfig"
        class="org.springframework.web.servlet.view.freemarker.FreeMarkerConfigurer">
        <!-- FIXME STS complains where is superclass -->
        <property name="templateLoaderPath" value="/WEB-INF/freemarker/" />
    </bean>

    <bean id="viewResolver"
        class="org.springframework.web.servlet.view.ResourceBundleViewResolver">
        <property name="basename" value="views" />
        <property name="order" value="0" />
    </bean>
    <!--
      - This bean resolves specific types of exception to corresponding error views.
      - The default behaviour of DispatcherServlet is to propagate all exceptions to the
      - servlet container: This will happen here with all other types of exception.
      -->
    <bean id="exceptionResolver"
        class="org.springframework.web.servlet.handler.SimpleMappingExceptionResolver">
        <property name="exceptionMappings">
            <props>
                <prop
                    key="org.springframework.dao.DataAccessException">
                    dataAccessFailure
                </prop>
                <prop
                    key="org.springframework.transaction.TransactionException">
                    dataAccessFailure
                </prop>
            </props>
        </property>
    </bean>

    <bean id="multipartResolver"
        class="org.springframework.web.multipart.commons.CommonsMultipartResolver">

        <!-- one of the properties available; the maximum file size in bytes -->
        <property name="maxUploadSize" value="20000000" />
    </bean>

    <!--
      - This bean is an explicit URL mapper that is used by the GeneDB DispatcherServlet
      - It is used instead of the default BeanNameUrlHandlerMapping. It builds paths
      - based upon the Controller's name
      -->
    <bean id="urlMapping"
        class="org.genedb.web.mvc.controller.CaseSensitiveControllerClassNameHandlerMapping">
        <property name="alwaysUseFullPath" value="true" />
        <property name="includeAnnotatedControllers" value="false" />
        <property name="interceptors">
            <list>
                <ref bean="openSessionInView" />
            </list>
        </property>
    </bean>

    <bean class="org.springframework.web.servlet.mvc.annotation.DefaultAnnotationHandlerMapping">
        <property name="interceptors">
            <list>
                <ref bean="openSessionInView" />
            </list>
        </property>
    </bean>


    <!-- ========================= CONTROLLER DEFINITIONS ========================= -->
    <!--
      - This bean is a MultiActionController that manages general View rendering.
      - It uses the "clinicControllerResolver" bean below for method name resolution.
      -->

    <bean id="MotifSearchController" class="org.genedb.web.mvc.controller.analysis.MotifSearchController">
    </bean>

    <bean id="DbLinkRedirect" class="org.genedb.web.mvc.controller.DbLinkRedirectController" />

    <bean id="HistoryController"
      class="org.genedb.web.mvc.controller.HistoryController">
        <property name="methodNameResolver"
          ref="historyControllerResolver"/>
        <property name="historyManagerFactory"
          ref="historyManagerFactory" />
        <property name="sequenceDao" ref="sequenceDao"/>
        <property name="historyView" value="history/historyIndex"/>
        <property name="jsonView" ref="jsonView"/>
        <property name="downloadView" value="download/download"/>
        <property name="editView" value="history/editHistory"/>
    </bean>

    <bean id="DownloadFeaturesController"
      class="org.genedb.web.mvc.controller.download.DownloadFeaturesController">
        <property name="historyManagerFactory"
          ref="historyManagerFactory" />
        <!-- <property name="sessionForm" value="true"/> -->
        <!-- <property name="commandName" value="download"/> -->
        <!-- <property name="commandClass"
          value="org.genedb.web.mvc.controller.download.DownloadBean" /> -->
        <property name="sequenceDao" ref="sequenceDao"/>
        <property name="luceneIndexFactory" ref="luceneIndexFactory"/>
        <!-- <property name="formView" value="download/download" /> -->
        <property name="downloadView" value="download/download" />
        <property name="jsonView" ref="jsonView"/>
        <!-- <property name="bindOnNewForm" value="true" /> -->
        <!-- <property name="validator" ref="downloadFeaturesValidator"/> -->
    </bean>

  <bean id="downloadFeaturesValidator" class="org.genedb.web.mvc.validators.DownloadFeaturesValidator" />

    <bean id="pfamLookup"
      class="org.genedb.web.mvc.controller.PfamLookup" />

    <bean id="GoFeatureController"
        class="org.genedb.web.mvc.controller.GoFeatureController">
        <property name="sessionForm" value="true" />
        <property name="commandClass"
            value="org.genedb.web.mvc.controller.GoLookup" />
        <property name="commandName" value="goLookup" />
        <property name="sequenceDao" ref="sequenceDao" />
        <property name="webUtils" ref="GeneDBWebUtils"/>
        <property name="listResultsView" value="features/GO" />
        <property name="formInputView" value="err/goerr" />
        <property name="bindOnNewForm" value="true" />
    </bean>

    <bean id="OrganismChooserController"
        class="org.genedb.web.mvc.controller.OrganismChooserController">
        <property name="commandClass"
            value="org.genedb.web.mvc.controller.OrganismChooserBean" />
    </bean>

    <bean id="ArtemisLaunchController"
        class="org.genedb.web.mvc.controller.ArtemisLaunchController" />


    <bean id="BasketController"
        class="org.genedb.web.mvc.controller.BasketController">
        <property name="modelBuilder" ref="modelBuilder"/>
        <property name="historyManagerFactory" ref="historyManagerFactory" />
        <property name="sequenceDao" ref="sequenceDao" />
    </bean>


    <bean id="ContextMapWindowController"
        class="org.genedb.web.gui.ContextMapWindowController" />

    <bean id="FeatureSequenceController"
        class="org.genedb.web.mvc.controller.FeatureSequenceController">
        <!-- <property name="commandClass" value="org.genedb.web.mvc.controller.FeatureSequenceController$FeatureSequenceBean"/> -->
        <property name="modelBuilder" ref="modelBuilder"/>
        <property name="sequenceDao" ref="sequenceDao"/>
        <property name="geneSequenceView" value="features/geneSequence"/>
    </bean>


    <bean id="SequenceDistributorController"
        class="org.genedb.web.mvc.controller.SequenceDistributorController">
                <property name="sequenceDao" ref="sequenceDao"/>
                        <property name="modelBuilder" ref="modelBuilder"/>
        <!-- Anything to inject? -->
    </bean>

    <bean name="historyManagerFactory"
        class="org.genedb.web.mvc.controller.HttpSessionHistoryManagerFactory" />

    <bean name="QueryController" class="org.genedb.web.mvc.controller.download.QueryController">
        <property name="queryFactory" ref="queryFactory" />
        <property name="resultsCacheFactory" ref="resultsCacheFactory" />
        <property name="taxonNodeArrayPropertyEditor" ref="taxonNodeArrayPropertyEditor" />
    </bean>

    <bean name="QuickSearchQueryController" class="org.genedb.web.mvc.controller.download.QuickSearchQueryController">
        <property name="queryFactory" ref="queryFactory" />
        <property name="resultsCacheFactory" ref="resultsCacheFactory" />
        <property name="taxonNodeArrayPropertyEditor" ref="taxonNodeArrayPropertyEditor" />
    </bean>


    <bean name="ResultsController" class="org.genedb.web.mvc.controller.download.ResultsController">
       <property name="queryFactory" ref="queryFactory" />
       <property name="resultsCacheFactory" ref="resultsCacheFactory" />
    </bean>

    <bean name="ResultsNavigatorController" class="org.genedb.web.mvc.controller.download.ResultsNavigatorController">
            <property name="resultsCacheFactory" ref="resultsCacheFactory" />
    </bean>

    <bean name="QueryListController" class="org.genedb.web.mvc.controller.download.QueryListController">
        <property name="queryFactory" ref="queryFactory" />
    </bean>

    <bean id="ImageController" class="org.genedb.web.mvc.controller.ImageController">
        <property name="berkeleyMapFactory" ref="berkeleyReadOnlyMapFactory" />
    </bean>

    <bean id="NamedFeatureController"
        class="org.genedb.web.mvc.controller.NamedFeatureController">
        <property name="sequenceDao" ref="sequenceDao" />
        <property name="modelBuilder" ref="modelBuilder"/>
        <property name="formView" value="search/nameLookup" />
        <property name="geneView" value="features/gene" />
        <property name="geneDetailsView" value="features/geneDetails" />
        <!-- <property name="bindOnNewForm" value="true" /> -->
        <!-- <property name="validator" ref="namedFeatureValidator" /> -->
        <!-- <property name="cacheSeconds" value="86400" /> -->
        <property name="berkeleyMapFactory" ref="berkeleyReadOnlyMapFactory" />
        <property name="historyManagerFactory" ref="historyManagerFactory" />
        <property name="taxonNodeArrayPropertyEditor" ref="taxonNodeArrayPropertyEditor" />
        <property name="resultsCacheFactory" ref="resultsCacheFactory" />
    </bean>
    <bean id="namedFeatureValidator"
        class="org.genedb.web.mvc.validators.NamedFeatureFormValidator" />

    <!--<bean name="luceneIndexFactory" class="org.genedb.querying.core.LuceneIndexFactory">
        <property name="luceneIndexList">
        <list>
            <bean class="org.genedb.querying.core.LuceneIndex">
                <property name="indexDirectoryName" value="${lucene.indexDirectory}" />
                <property name="indexName" value="org.gmod.schema.mapped.Feature" />
            </bean>
        </list>
        </property>
    </bean> -->

    <bean id="ContextMapController" class="org.genedb.web.mvc.controller.ContextMapController">
        <property name="berkeleyMapFactory" ref="berkeleyReadOnlyMapFactory" />
    </bean>

<!--  	<bean id="AdvancedSearchController"
        class="org.genedb.web.mvc.controller.AdvancedSearchController">
        <property name="sessionForm" value="true" />
        <property name="commandName" value="advancedSearchLookup" />
        <property name="commandClass"
            value="org.genedb.web.mvc.controller.AdvancedSearchController$AdvancedSearchBean" />
        <property name="luceneIndexFactory" ref="luceneIndexFactory" />
        <property name="resultsView" value="list/terms" />
        <property name="formView" value="search/advancedSearch" />
        <property name="geneView" value="redirect:NamedFeature" />
        <property name="jsonView" ref="jsonView" />
        <property name="bindOnNewForm" value="true" />
        <property name="historyManagerFactory" ref="historyManagerFactory" />
    </bean> -->

    <bean id="FeatureDownloadController"
        class="org.genedb.web.mvc.controller.download.FeatureDownloadController">
        <!-- <property name="sessionForm" value="true" />
        <property name="commandName" value="featureDownload" />
        <property name="commandClass"
            value="org.genedb.web.mvc.controller.download.FeatureDownloadController$FeatureDownloadBean" /> -->
        <property name="sequenceDao" ref="sequenceDao" />
        <property name="sequenceView" value="download/featureDownload" />
        <!-- <property name="formView" value="search/featureDownload" /> -->
        <!-- <property name="bindOnNewForm" value="true" /> -->
        <property name="taxonNodeArrayPropertyEditor"
            ref="taxonNodeArrayPropertyEditor" />
        <!-- <property name="cacheSeconds" value="86400" /> -->
    </bean>

    <bean id="OrthologsController"
        class="org.genedb.web.mvc.controller.OrthologsController">
        <property name="sequenceDao" ref="sequenceDao" />
        <property name="listResultsView" value="list/results2" />
        <property name="genePage" value="redirect:NamedFeature" />
        <property name="resultsCacheFactory" ref="resultsCacheFactory" />
    </bean>

    <bean id="BrowseCategoryController"
        class="org.genedb.web.mvc.controller.BrowseCategoryController">
        <!-- <property name="sessionForm" value="true" />
        <property name="commandName" value="browseCategory" />
        <property name="commandClass"
            value="org.genedb.web.mvc.controller.BrowseCategoryController$BrowseCategoryBean" /> -->
        <property name="cvDao" ref="cvDao" />
        <property name="successView" value="list/categories" />
        <property name="formView" value="search/browseCategory" />
        <!-- <property name="bindOnNewForm" value="true" />
        <property name="taxonNodeArrayPropertyEditor"
            ref="taxonNodeArrayPropertyEditor" />
        <property name="validator" ref="browseCategoryValidator" /> -->
    </bean>

    <bean id="browseCategoryValidator"
        class="org.genedb.web.mvc.validators.BrowseCategoryFormValidator" />

    <bean id="BrowseTermController"
        class="org.genedb.web.mvc.controller.BrowseTermController">
        <!-- <property name="sessionForm" value="true" />
        <property name="commandName" value="browseTerm" />
        <property name="commandClass"
            value="org.genedb.web.mvc.controller.BrowseTermBean" /> -->
        <property name="sequenceDao" ref="sequenceDao" />
        <property name="luceneIndexFactory" ref="luceneIndexFactory" />
        <property name="successView" value="list/terms" />
        <!-- <property name="formView" value="search/browseTerm" /> -->
        <property name="geneView" value="redirect:NamedFeature" />
        <property name="jsonView" ref="jsonView" />
        <property name="historyManagerFactory" ref="historyManagerFactory" />
        <!-- <property name="bindOnNewForm" value="true" /> -->
    </bean>

    <bean id="ComplexQueryController"
        class="org.genedb.web.mvc.controller.ComplexQueryController">
        <property name="webUtils" ref="GeneDBWebUtils"/>
    </bean>


    <bean id="GeneDBWebUtils"
        class="org.genedb.web.mvc.controller.GeneDBWebUtils">
        <property name="sequenceDao" ref="sequenceDao" />
    </bean>

    <bean id="jsonConfig" class="net.sf.json.JsonConfig" />
    <bean id="jsonView"
        class="net.sf.json.spring.web.servlet.view.JsonView">
        <property name="jsonConfig" ref="jsonConfig" />
    </bean>

  <bean id="AdminController"
        class="org.genedb.web.mvc.controller.AdminController">
        <property name="methodNameResolver"
            ref="searchControllerResolver" />
        <property name="dataSource" ref="dataSource" />
    </bean>

    <bean id="openSessionInView"
        class="org.springframework.orm.hibernate3.support.OpenSessionInViewInterceptor">
        <property name="sessionFactory">
            <ref bean="sessionFactory" />
        </property>
    </bean>

  <bean id="embossDigestParser" class="org.genedb.web.mvc.controller.cgview.EmbossDigestParser">
        <property name="embossDir">
          <value>${psu.emboss.directory}</value>
        </property>
    </bean>

  <bean id="cachedFileFactory"
        class="org.genedb.web.mvc.controller.cgview.CachedFileFactory" />

  <bean id="CircularGenomeController" class="org.genedb.web.mvc.controller.cgview.CircularGenomeFormController">
      <property name="commandClass" value="org.genedb.web.mvc.controller.cgview.CircularGenomeCommandBean" />
      <property name="formView" value="graphics/circularGenomeForm" />
            <property name="cachedFileFactory" ref="cachedFileFactory" />
            <property name="embossDigestParser" ref="embossDigestParser"/>
            <property name="embossDirectoryName">
               <value>${emboss.directory}</value>
            </property>
      <property name="diagramView" value="graphics/circularGenome" />
    </bean>

    <bean id="HomepageController"
        class="org.genedb.web.mvc.controller.HomepageController">
        <property name="taxonNodeArrayPropertyEditor"
            ref="taxonNodeArrayPropertyEditor" />
    </bean>

    <bean id="searchControllerResolver"
        class="org.springframework.web.servlet.mvc.multiaction.InternalPathMethodNameResolver" />
    <bean id="historyControllerResolver"
        class="org.springframework.web.servlet.mvc.multiaction.InternalPathMethodNameResolver" />
    <bean id="complexControllerResolver"
        class="org.springframework.web.servlet.mvc.multiaction.InternalPathMethodNameResolver" />


    <bean id="modelBuilder" class="org.genedb.web.mvc.controller.ModelBuilder">
         <property name="diagramCache" ref="diagramCache" />
     </bean>


</beans>
