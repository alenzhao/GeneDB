<?xml version="1.0" encoding="UTF-8" ?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:util="http://www.springframework.org/schema/util"
	xmlns:dwr="http://www.directwebremoting.org/schema/spring-dwr"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
	http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-2.0.xsd
        http://www.directwebremoting.org/schema/spring-dwr http://www.directwebremoting.org/schema/spring-dwr-2.0.xsd"
	default-init-method="postConstruction">

	<!-- ========================= MESSAGE SOURCE DEFINITION ========================= -->

	<!--
		- Message source for this context, loaded from localized "messages_xx" files.
		- Could also reside in the root application context, as it is generic,
		- but is currently just used within PetClinic's web tier.
    -->
	<bean id="messageSource" class="org.springframework.context.support.ResourceBundleMessageSource">
        <property name="basenames">
            <list>
                <value>exceptions</value>
            </list>
        </property>
	</bean>
	
	<!-- ========================= MAPPING DEFINITIONS ========================= -->

 
    <bean id="goProcessBrowse" class="org.genedb.web.mvc.controller.BrowseBean">
        <dwr:remote javascript="goPBrowse">
           <dwr:include method="getPossibleMatches" />
        </dwr:remote>
        <property name="cvDaoI"  ref="cvDao" />
        <property name="sequenceDaoI"  ref="sequenceDao" />
        <property name="cvNames">
        	<list>
        		<value>biological_process</value>
        		<value>cellular_component</value>
        		<value>molecular_function</value>
        		<value>RILEY</value>
        		<value>genedb_products</value>
        		<value>CC_genedb_controlledcuration</value>
        		<!-- <value>UNIPROT_KEYWORDS</value> -->
        	</list>
        </property>
    </bean>
	
	<bean id="grep" class="org.genedb.web.utils.Grep">
		<property name="file" value="/Users/cp2/artemis-log/combinedAll"/>
	</bean>
	
	<bean id="nameBrowse" class="org.genedb.web.mvc.controller.BrowseBeanName">
		<dwr:remote javascript="nameBrowse">
           <dwr:include method="getPossibleMatches" />
        </dwr:remote>
        <property name="cvDaoI" ref="cvDao" />
        <property name="sequenceDaoI" ref="sequenceDao"/>
        <property name="cvTerm" value="gene"/>
	</bean>
    <dwr:controller id="dwrController" debug="true"/>

    <dwr:configuration>
       <!-- <dwr:create type="new" javascript="AjaxHelper" class="com.interface21.springone.AjaxHelper"/>
        <dwr:convert type="bean" class="com.interface21.springone.data.Person"/> -->
    </dwr:configuration>


	<!--
	  - This bean provides explicit View mappings in a resource bundle instead of the
	  - default InternalResourceViewResolver. It fetches the view mappings from
	  - localized "views_xx" classpath files, i.e. "/WEB-INF/classes/views.properties"
	  - or "/WEB-INF/classes/views_de.properties".
	  -
	  - Symbolic view names returned by Controllers will be resolved by this bean
	  - using the respective properties file, which defines arbitrary mappings between
	  - view names and resources.
	  -->
<!--	<bean id="viewResolver" class="org.springframework.web.servlet.view.ResourceBundleViewResolver">-->
<!--		<property name="basename" value="views"/>-->
<!--		<property name="order" value="5" />-->
<!--	</bean>-->

	<bean id="checkingViewResolver" class="org.genedb.web.mvc.controller.FileCheckingInternalResourceViewResolver" init-method="postConstruction">
		<property name="viewClass" value="org.springframework.web.servlet.view.JstlView"/>
		<property name="prefix" value="/WEB-INF/jsp/" />
		<property name="suffix" value=".jsp" />
		<property name="order" value="3" />
	</bean>
	
	<bean id="freemarkerConfig" class="org.springframework.web.servlet.view.freemarker.FreeMarkerConfigurer">
  		<property name="templateLoaderPath" value="/WEB-INF/freemarker/artemis/"/>
	</bean>
	
	<!-- <bean id="freemarkerviewResolver" class="org.springframework.web.servlet.view.freemarker.FreeMarkerViewResolver">
	  <property name="cache" value="true"/>
	  <property name="contentType" value="application/x-java-jnlp-file"/>
	  <property name="prefix" value=""/>
	  <property name="suffix" value=".jnlp"/> 
	  

	  <property name="exposeSpringMacroHelpers" value="true"/>
	
	</bean> -->
	
	<bean id="viewResolver" class="org.springframework.web.servlet.view.ResourceBundleViewResolver">
    	<property name="basename" value="views"/>
    	<property name="order" value="0"/>
	</bean>
	<!--
	  - This bean resolves specific types of exception to corresponding error views.
		- The default behaviour of DispatcherServlet is to propagate all exceptions to the
		- servlet container: This will happen here with all other types of exception.
		-->
	<bean id="exceptionResolver" class="org.springframework.web.servlet.handler.SimpleMappingExceptionResolver">
		<property name="exceptionMappings">
			<props>
				<prop key="org.springframework.dao.DataAccessException">dataAccessFailure</prop>
				<prop key="org.springframework.transaction.TransactionException">dataAccessFailure</prop>
			</props>
		</property>
	</bean>

	<bean id="multipartResolver"
   	 class="org.springframework.web.multipart.commons.CommonsMultipartResolver">

    	<!-- one of the properties available; the maximum file size in bytes -->
   		 <property name="maxUploadSize" value="20000000"/>
	</bean>

	<!--
	 - This bean is an explicit URL mapper that is used by the GeneDB DispatcherServlet
	 - It is used instead of the default BeanNameUrlHandlerMapping. It builds paths 
	 - based upon the Controller's name 
	 -->
	<bean id="urlMapping" class="org.genedb.web.mvc.controller.CaseSensitiveControllerClassNameHandlerMapping">
		<property name="alwaysUseFullPath" value="true" />
		 <property name="interceptors">
      <list>
        <ref bean="openSessionInView"/>
      </list>
    </property>
	</bean>


    <bean id="dwrHandlerMappings" class="org.springframework.web.servlet.handler.SimpleUrlHandlerMapping">
        <property name="order" value="1" />
        <property name="alwaysUseFullPath" value="true"></property>
        <property name="mappings">
            <props>
                <prop key="/dwr/**/*">dwrController</prop>
            </props>
        </property>
    </bean>


	<!-- ========================= CONTROLLER DEFINITIONS ========================= -->

	<!--
	  - This bean is a MultiActionController that manages general View rendering.
	  - It uses the "clinicControllerResolver" bean below for method name resolution.
	  -->
<!--	<bean id="genedbController" class="org.genedb.web.mvc.controller.NonFormController">-->
<!--		<property name="methodNameResolver" ref="genedbControllerResolver"/>-->
<!-- 		 <property name="clinic" ref="clinic"/> -->
<!--	</bean>-->
<!--    -->
<!---->
<!--    <bean id="commonURLController" class="org.genedb.web.mvc.controller.GenomeController"> -->
         <!-- <property name="methodNameResolver" ref="genedbControllerResolver"/> -->
<!--         <property name="root" ref="org-Root" />
    </bean> -->

	<!--
	  - This bean is a MethodNameResolver definition for a MultiActionController.
	  - It maps URLs to methods for the "clinicController" bean.
	  -->
<!--	<bean id="genedbControllerResolver" class="org.springframework.web.servlet.mvc.multiaction.PropertiesMethodNameResolver">-->
<!--		<property name="mappings">-->
<!--		<props>-->
<!--			<prop key="/index.html">homepageHandler</prop>-->
<!--             <prop key="/Homepage">homepageHandler</prop>-->
<!--			<prop key="/feature.html">featureHandler</prop>-->
<!--             <prop key="/dropDown.html">dropDownHandler</prop>-->
<!--             <prop key="/common">commonURLHandler</prop>-->
<!--             <prop key="/examples">examplesHandler</prop>-->
<!--			<prop key="/pfam.html">pfamHandler</prop>-->
<!--		</props>-->
<!--		</property>-->
<!--	</bean>-->


    <!--
      - This bean is a MultiActionController that manages general View rendering.
      - It uses the "clinicControllerResolver" bean below for method name resolution.
      -->
    <bean id="SearchController" class="org.genedb.web.mvc.controller.SearchController">
        <property name="methodNameResolver" ref="searchControllerResolver"/>
        <property name="viewChecker" ref="checkingViewResolver"/>
        <property name="sequenceDao" ref="sequenceDao"/>
        <property name="cvDao" ref="cvDao"/>
    </bean>
    
    <bean id="HistoryController" class="org.genedb.web.mvc.controller.HistoryController">
        <property name="methodNameResolver" ref="historyControllerResolver"/>
        <property name="historyManagerFactory" ref="historyManagerFactory" />
        <property name="sequenceDao" ref="sequenceDao"/>
    </bean>
     
  <bean id="DownloadFeaturesController" class="org.genedb.web.mvc.controller.download.DownloadFeaturesController">
        <property name="historyManagerFactory" ref="historyManagerFactory" />
        <property name="sessionForm" value="true"/>
        <property name="commandName" value="downloadOptions"/>
        <property name="commandClass" value="org.genedb.web.mvc.controller.download.DownloadBean" />
		<property name="sequenceDao" ref="sequenceDao"/>
        <property name="formView" value="search/download" />
        <property name="bindOnNewForm" value="true" />
    </bean>
       
    <bean id="pfamLookup" class="org.genedb.web.mvc.controller.PfamLookup" /> 
       
    <bean id="StaticController" class="org.genedb.web.mvc.controller.StaticController"/>
    
    <bean id="GoFeatureController" class="org.genedb.web.mvc.controller.GoFeatureController">
    	<property name="sessionForm" value="true"/>
    	<property name="commandClass" value="org.genedb.web.mvc.controller.GoLookup"/>
    	<property name="commandName" value="goLookup"/>
    	<property name="sequenceDao" ref="sequenceDao"/>
    	<property name="organismDao" ref="organismDao"/>
    	<property name="listResultsView" value="features/GO"/>
    	<property name="formInputView" value="err/goerr"/>
    	<property name="bindOnNewForm" value="true" />
    </bean>
    
    <bean id="LuceneSearchController" class="org.genedb.web.mvc.controller.LuceneSearchController">
    	<property name="sessionForm" value="true"/>
    	<property name="commandClass" value="org.genedb.web.mvc.controller.LuceneSearch"/>
    	<property name="commandName" value="luceneSearch"/>
    	<property name="listResultsView" value="features/results"/>
    	<property name="formView" value="search/lucene"/>
    	<property name="bindOnNewForm" value="true" />
    	<property name="taxonNodeArrayPropertyEditor" ref="taxonNodeArrayPropertyEditor" />
        <property name="historyManagerFactory" ref="historyManagerFactory" />
    </bean>
    
    <bean id="OrganismChooserController" class="org.genedb.web.mvc.controller.OrganismChooserController">
    	<property name="commandClass" value="org.genedb.web.mvc.controller.OrganismChooserBean"/>
    </bean>
    
    <bean id="ArtemisLaunchController" class="org.genedb.web.mvc.controller.ArtemisLaunchController">
    </bean>
    
    <bean id="ProductSearchController" class="org.genedb.web.mvc.controller.ProductSearchController">
    	<property name="sessionForm" value="true"/>
    	<property name="commandClass" value="org.genedb.web.mvc.controller.ProductLookupBean"/>
    	<property name="commandName" value="productSearch"/>
    	<property name="listResultsView" value="features/product"/>
    	<property name="formView" value="search/product"/>
    	<property name="bindOnNewForm" value="true" />
    	<property name="taxonNodeArrayPropertyEditor" ref="taxonNodeArrayPropertyEditor" />
        <property name="historyManagerFactory" ref="historyManagerFactory" />
    </bean>
    
    <bean name="historyManagerFactory" class="org.genedb.web.mvc.controller.HttpSessionHistoryManagerFactory" />
    
    <bean name="webUtils" class="org.genedb.web.mvc.controller.WebUtils">
		<property name="sequenceDao" ref="sequenceDao"/>
	</bean>
	
    <bean id="NamedFeatureController" class="org.genedb.web.mvc.controller.NamedFeatureController">
<!--        <property name="viewChecker" ref="checkingViewResolver"/>-->
        <property name="sessionForm" value="true"/>
        <property name="commandName" value="nameLookup"/>
        <property name="commandClass" value="org.genedb.web.mvc.controller.NameLookupBean" />
		<property name="luceneDao" ref="luceneDao"/>
		<property name="sequenceDao" ref="sequenceDao" />
        <property name="listResultsView" value="list/features" />
        <property name="formView" value="search/nameLookup" />
        <property name="bindOnNewForm" value="true" />
        <property name="taxonNodeArrayPropertyEditor" ref="taxonNodeArrayPropertyEditor" />
        <property name="historyManagerFactory" ref="historyManagerFactory" />
		<property name="grep" ref="grep"/>
    </bean>
    
    <bean id="SearchAllController" class="org.genedb.web.mvc.controller.SearchAllController">
<!--        <property name="viewChecker" ref="checkingViewResolver"/>-->
        <property name="sessionForm" value="true"/>
        <property name="commandName" value="searchAll"/>
        <property name="commandClass" value="org.genedb.web.mvc.controller.SearchAllBean" />
		<property name="luceneDao" ref="luceneDao"/>
        <property name="listResultsView" value="list/searchAll" />
        <property name="formView" value="search/searchAll" />
        <property name="bindOnNewForm" value="true" />
        <property name="taxonNodeArrayPropertyEditor" ref="taxonNodeArrayPropertyEditor" />
        <property name="historyManagerFactory" ref="historyManagerFactory" />
    </bean>
    
    <bean id="CurationController" class="org.genedb.web.mvc.controller.CurationController">
<!--        <property name="viewChecker" ref="checkingViewResolver"/>-->
        <property name="sessionForm" value="true"/>
        <property name="commandName" value="curation"/>
        <property name="commandClass" value="org.genedb.web.mvc.controller.CurationBean" />
		<property name="luceneDao" ref="luceneDao"/>
        <property name="listResultsView" value="list/searchCuration" />
        <property name="formView" value="search/searchCuration" />
        <property name="bindOnNewForm" value="true" />
        <property name="taxonNodeArrayPropertyEditor" ref="taxonNodeArrayPropertyEditor" />
        <property name="historyManagerFactory" ref="historyManagerFactory" />
    </bean>
    
    <bean id="ExtController" class="org.genedb.web.mvc.controller.ExtController">
        <property name="sessionForm" value="true"/>
        <property name="commandName" value="ext"/>
        <property name="commandClass" value="org.genedb.web.mvc.controller.ExtBean" />
		<property name="sequenceDao" ref="sequenceDao"/>
        <property name="bindOnNewForm" value="true" />
        <property name="historyManagerFactory" ref="historyManagerFactory" />
    </bean>
    
    <bean id="BrowseCategoryController" class="org.genedb.web.mvc.controller.BrowseCategoryController">
        <!-- <property name="sessionForm" value="true"/> -->
        <property name="commandName" value="browseCategory"/>
		<property name="commandClass" value="org.genedb.web.mvc.controller.BrowseCategoryBean" />
		<property name="cvDao" ref="cvDao"/>	
        <property name="successView" value="list/categories" />
        <property name="formView" value="search/browseCategory" />
        <property name="bindOnNewForm" value="true" />
        <property name="taxonNodeArrayPropertyEditor" ref="taxonNodeArrayPropertyEditor" />
    </bean>
    
    <bean id="BrowseTermController" class="org.genedb.web.mvc.controller.BrowseTermController">
        <!-- <property name="sessionForm" value="true"/> -->
        <property name="commandName" value="browseTerm"/>
		<property name="commandClass" value="org.genedb.web.mvc.controller.BrowseTermBean" />
		<property name="sequenceDao" ref="sequenceDao"/>	
        <property name="successView" value="list/features3" />
        <property name="formView" value="search/browseTerm" />
        <property name="bindOnNewForm" value="true" />
        <property name="taxonNodeArrayPropertyEditor" ref="taxonNodeArrayPropertyEditor" />
    </bean>
    
      <!-- <bean id="embossDigestParser" class="org.genedb.web.mvc.controller.cgview.EmbossDigestParser">
        <property name="embossDir" value="/nfs/disk100/pubseq/emboss" />
    </bean> -->
    
    <bean id="cachedFileFactory" class="org.genedb.web.mvc.controller.cgview.CachedFileFactory">
  
    </bean> 
     
	<!--  <bean id="CircularGenomeController" class="org.genedb.web.mvc.controller.cgview.CircularGenomeFormController">
			<property name="commandClass" value="org.genedb.web.mvc.controller.cgview.CircularGenomeCommandBean" />
			<property name="formView" value="graphics/circularGenomeForm" />
            <property name="embossDigestParser" ref="embossDigestParser" />
            <property name="cachedFileFactory" ref="cachedFileFactory" />
                private ExecutionService restrictService;
    
    private ExecutionService digestService; 


    </bean> -->
    
        <bean id="AdminController" class="org.genedb.web.mvc.controller.AdminController">
        <property name="methodNameResolver" ref="searchControllerResolver"/>
        <!-- <property name="viewChecker" ref="checkingViewResolver"/> -->
        <property name="dataSource" ref="dataSource"/>
    </bean>

  <bean id="openSessionInView" class="org.springframework.orm.hibernate3.support.OpenSessionInViewInterceptor">
    <property name="sessionFactory"><ref bean="sessionFactory"/></property>
  </bean>
	
    
	<!-- <bean id="pubHome" class="org.genedb.db.hibernate.PubHome" /> -->
    
	<bean id="HomepageController" class="org.genedb.web.mvc.controller.HomepageController">
        <property name="taxonNodeArrayPropertyEditor" ref="taxonNodeArrayPropertyEditor" />
    </bean>
    
<!--	<bean id="OrganismController" class="org.genedb.web.mvc.controller.OrganismController">
		<property name="root" ref="org-Root" />
    </bean> -->
    
    <!--
      - This bean is a MethodNameResolver definition for a MultiActionController.
      - It maps URLs to methods for the "clinicController" bean.
      -->
      <bean id="searchControllerResolver" class="org.springframework.web.servlet.mvc.multiaction.InternalPathMethodNameResolver" />
      <bean id="historyControllerResolver" class="org.springframework.web.servlet.mvc.multiaction.InternalPathMethodNameResolver" />
      <bean id="complexControllerResolver" class="org.springframework.web.servlet.mvc.multiaction.InternalPathMethodNameResolver" />

	<!--
	  - This bean is a SimpleFormController that manages the editOwner use case.
	  - It uses the "ownerValidator" and "clinic" beans.
	  --><!--
	<bean id="editOwnerForm" class="org.springframework.samples.petclinic.web.EditOwnerForm">
		<property name="formView" value="ownerForm"/>
		<property name="successView" value="ownerRedirect"/>
		<property name="validator" ref="ownerValidator"/>
		 <property name="clinic" ref="clinic"/> 
	</bean>

	-->
	<!--
		- Validator for owner forms, implementing Spring's Validator interface.
		- Could also reside in the root application context, as it is generic,
		- but is currently just used within PetClinic's web tier.
	  --><!--
	<bean id="ownerValidator" class="org.springframework.samples.petclinic.validation.OwnerValidator"/>

	--><!--
	  - This bean is a SimpleFormController that manages the addPet use case.
	  - It uses the "petValidator" and "clinic" beans.
	  --><!--
	<bean id="addPetForm" class="org.springframework.samples.petclinic.web.AddPetForm">
		<property name="formView" value="petForm"/>
		<property name="successView" value="ownerRedirect"/>
		<property name="validator" ref="petValidator"/>
		<property name="clinic" ref="clinic"/>
	</bean>

	--><!--
	  - This bean is a SimpleFormController that manages the editPet use case.
	  - It uses the "petValidator" and "clinic" beans.
	  --><!--
	<bean id="editPetForm" class="org.springframework.samples.petclinic.web.EditPetForm">
		<property name="formView" value="petForm"/>
		<property name="successView" value="ownerRedirect"/>
		<property name="validator" ref="petValidator"/>
		<property name="clinic" ref="clinic"/>
	</bean>

	--><!--
		- Validator for pet forms, implementing Spring's Validator interface.
		- Could also reside in the root application context, as it is generic,
		- but is currently just used within PetClinic's web tier.
 		--><!--
	<bean id="petValidator" class="org.springframework.samples.petclinic.validation.PetValidator"/>

	--><!--
	  - This bean is a SimpleFormController that manages the addVisit use case.
	  - It uses the "visitValidator" and "clinic" beans.
	  --><!--
	<bean id="addVisitForm" class="org.springframework.samples.petclinic.web.AddVisitForm">
		<property name="formView" value="visitForm"/>
		<property name="successView" value="ownerRedirect"/>
		<property name="validator" ref="visitValidator"/>
		<property name="clinic" ref="clinic"/>
	</bean>

	--><!--
		- Validator for visit forms, implementing Spring's Validator interface.
		- Could also reside in the root application context, as it is generic,
		- but is currently just used within PetClinic's web tier.
 		--><!--
	<bean id="visitValidator" class="org.springframework.samples.petclinic.validation.VisitValidator"/>

--></beans>
