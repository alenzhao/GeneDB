<?xml version="1.0"?>

<project name="genedb-web" default="get-latest-jars" basedir=".">

	<!-- Paths/Properties you may have to change -->
	
	<property file="property-file.${deploy}" />
	
	<property name="version" value="0.2"/>
	<property name="jar-build" value="ant-build/jar-build"/>
	<property name="lib-dir" value="WebContent/WEB-INF/lib"/>
	<property name="finaldest.webapps" value="/Users/cp2/tomcat/ROOT"/>
	
	<!-- Classpaths -->
	
	<path id="compile-lib">
			<path location="${lib-dir}/spring-2.0.2.jar" />
			<path location="${lib-dir}/lucene-core-2.0.1-dev.jar" />
	        <path location="${lib-dir}/genedb-hibernate.jar" />
	        <path location="${lib-dir}/genedb-access.jar" />
	        <path location="${lib-dir}/chado-interface.jar" />
	        <path location="${lib-dir}/genedb-query.jar" />
	        <path location="${lib-dir}/jstl.jar" />
	        <path location="${lib-dir}/jdom.jar" />
	        <path location="${lib-dir}/cgview.jar" />
	        <path location="${lib-dir}/commons-lang-2.1.jar" />
	        <path location="${lib-dir}/biojava-1.5-beta2.jar" />
	        <path location="${lib-dir}/displaytag-1.1.jar" />
	        <path location="${lib-dir}/commons-logging.jar" />
	        <path location="${lib-dir}/ejb3-persistence.jar" />
			<path location="${lib-dir}/hibernate-annotations.jar" />
			<path location="lib/servlet-api.jar" />
			<path location="lib/jsp-api.jar" />
			<path location="${lib-dir}/antlr-runtime-3.0.jar"/>
			<path location="${lib-dir}/cglib-2.1.3.jar"/>
			<path location="${lib-dir}/commons-io.jar"/>
			<path location="${lib-dir}/poi-3.0.1.jar"/>
			<path location="${lib-dir}/json_simple.jar"/>
	</path>
	
	<target name="wrong-setup" >
		<mkdir dir="ant-build" />
		<mkdir dir="ant-build/src-interface" />
		<mkdir dir="ant-build/classes-interface" />
		<mkdir dir="ant-build/src-implementation" />
		<mkdir dir="ant-build/classes-implementation" />
		<mkdir dir="ant-build/src-1.4-interface" />
		<mkdir dir="ant-build/classes-1.4-interface-pre" />
		<mkdir dir="ant-build/classes-1.4-interface-post" />
		<mkdir dir="ant-build/jars" />
	</target>
	

	<target name="get-latest-jars" depends="" 
		description="Copy over JAR files from other projects">
		<copy file="../genedb-db/ant-build/jars/genedb-hibernate.jar" todir="WebContent/WEB-INF/lib" />
		<copy file="../genedb-db/ant-build/jars/chado-interface.jar" todir="WebContent/WEB-INF/lib" />
		<copy file="../genedb-access/genedb-access.jar" todir="WebContent/WEB-INF/lib" />
	</target>
	
	<target name="make-other-projects">
		<ant dir="../genedb-db" target="alljars" />
		<ant dir="../genedb-access" target="get-latest-jars" />
		<ant dir="../genedb-access" target="genedb-access.jar" />
		<antcall target="get-latest-jars"/>
	</target>
	
	<target name="make-all-and-deploy" depends="compile, deploy"/>
	
	<!-- ================================= 
          target: compile             
         ================================= -->
    <target name="compile" depends="" 
    	description="--> Compile classes">

    	<mkdir dir="ant-build/classes"/>
		<javac srcdir="src" classpathref="compile-lib" destdir="ant-build/classes" debug="on">
<compilerarg line="-Xlint:unchecked" />
</javac>
    	
<!--		<jar jarfile="ant-build/jars/chado-interface.jar">
			<fileset dir="ant-build/classes-interface" />
			<manifest>
				<attribute name="Implementation-Title" value="Chado Interface"/>
				<attribute name="Implementation-Version" value="${version}"/>
			</manifest>
		</jar> -->
    	
    </target>
	
	<target name="deploy">
		<filter token="webAppRootKey" value="${webAppRootKey}" />
		<delete dir="${finaldest.webapps}.tmp" failonerror="false"/>
		<copy todir="${finaldest.webapps}.tmp">
			<fileset dir="WebContent" casesensitive="false" followSymLinks="false" excludesfile="WebContent/WEB-INF/web.xml"/>
		</copy>
		<echo message="About to filter web.xml" />
		<delete file="${finaldest.webapps}.tmp/WEB-INF/web.xml" failonerror="false" />
		<copy file="WebContent/WEB-INF/web.xml" tofile="${finaldest.webapps}.tmp/WEB-INF/web.xml" filtering="true" />
		<echo message="Done filtering web.xml" />
		<copy todir="${finaldest.webapps}.tmp/WEB-INF/classes">
			<fileset dir="ant-build/classes" casesensitive="false" followSymLinks="false" />
		</copy>
		<copy file="property-file.${deploy}" tofile="${finaldest.webapps}.tmp/WEB-INF/classes/project.properties" />
		<echo>About to delete ${finaldest.webapps}.old</echo>
		<delete dir="${finaldest.webapps}.old" failonerror="false"/>
		<move file="${finaldest.webapps}" tofile="${finaldest.webapps}.old" failonerror="false" />
		<move file="${finaldest.webapps}.tmp" tofile="${finaldest.webapps}" />
		<delete dir="${finaldest.webapps}.old" failonerror="false"/> <!-- temp hack -->

	</target>
	
</project>
