<?xml version="1.0"?>

<project name="genedb-web" default="get-latest-jars" basedir=".">

	<target name="get-latest-jars" depends="" 
		description="Copy over JAR files from other projects">
		<copy file="../genedb-db/ant-build/jars/genedb-hibernate.jar" todir="WebContent/WEB-INF/lib" />
		<copy file="../genedb-db/ant-build/jars/chado-interface.jar" todir="WebContent/WEB-INF/lib" />
		<copy file="../genedb-access/genedb-access.jar" todir="WebContent/WEB-INF/lib" />
	</target>
	
	<target name="make-other-projects">
		<ant dir="../genedb-db" target="alljars" />
		<ant dir="../genedb-access" target="genedb-access.jar" />
		<antcall target="get-latest-jars"/>
	</target>
	
	<target name="make-all-and-deploy" depends="make-other-projects, compile, deploy"/>
	
	<!-- ================================= 
          target: compile             
         ================================= -->
    <target name="compile" depends="" 
    	description="--> Prepare a JAR file with the chado/JDK1.5+ interface">

		<copy todir="ant-build/src-interface">
			<fileset dir="src">
			    <include name="org/gmod/schema/**/*.java"/>
			</fileset>
		</copy>
    	
    	<mkdir dir="ant-build/classes"/>
		<javac srcdir="src" classpathref="tools-interface-compile-lib" destdir="ant-build/classes" debug="on" />
    	
		<jar jarfile="ant-build/jars/chado-interface.jar">
			<fileset dir="ant-build/classes-interface" />
			<manifest>
				<attribute name="Implementation-Title" value="Chado Interface"/>
				<attribute name="Implementation-Version" value="${version}"/>
			</manifest>
		</jar>
    	
    </target>
	
	<target name="deploy">
			<copy todir="${finaldest.webapps}.tmp">
				<fileset dir="${webapp.staging}" casesensitive="false" followSymLinks="false" />
			</copy>
	    	<delete dir="${finaldest.webapps}.old" failonerror="false"/>
			<!-- Do  moves, then rm -->
			<move file="${finaldest.webapps}" tofile="${finaldest.webapps}.old" />
			<move file="${finaldest.webapps}.tmp" tofile="${finaldest.webapps}" />

	</target>
	
</project>
