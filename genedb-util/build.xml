<project name="genedb-util" default="fulljar" basedir=".">

    <dirname property="imported.basedir.util" file="${ant.file.genedb-util}"/>

    <path id="anttasks-jars">
        <filelist dir="${imported.basedir.util}/../genedb-libs/lib">
            <file name="spring-bundle-2.5.6/ant/ant.jar" />
        </filelist>
    </path>

    <path id="test-jars">
        <filelist dir="${imported.basedir.util}/../genedb-libs/lib">
            <file name="spring-bundle-2.5.6/junit/junit-4.4.jar" />
        </filelist>
        <pathelement location="${imported.basedir.util}/ant-build/jars/genedb-util.jar"/>
    </path>

    <target name="clean-build-util" >
        <delete dir="${imported.basedir.util}/ant-build" quiet="true"/>
    </target>

    <target name="setup-util" >
        <mkdir dir="${imported.basedir.util}/ant-build" />
        <mkdir dir="${imported.basedir.util}/ant-build/classes" />
        <mkdir dir="${imported.basedir.util}/ant-build/test-classes" />
        <mkdir dir="${imported.basedir.util}/ant-build/anttasks-classes" />
        <mkdir dir="${imported.basedir.util}/ant-build/jars" />
    </target>

    <target name="compile-tests" depends="fulljar">
        <javac srcdir="${imported.basedir.util}/test" destdir="${imported.basedir.util}/ant-build/test-classes" debug="on">
            <classpath refid="test-jars"/>
        </javac>
    </target>

    <target name="run-tests" depends="compile-tests">
        <junit printsummary="withOutAndErr" haltonfailure="yes" fork="true" showoutput="true">
            <classpath>
                <path refid="test-jars"/>
                <pathelement location="${imported.basedir.util}/ant-build/test-classes"/>
            </classpath>
            <batchtest>
              <fileset dir="${imported.basedir.util}/ant-build/test-classes">
                <include name="**/*Test.*" />
              </fileset>
            </batchtest>
        </junit>
    </target>

    <target name="fulljar" depends="clean-build-util,setup-util" description="Create full JAR file">

        <javac srcdir="${imported.basedir.util}/src" destdir="${imported.basedir.util}/ant-build/classes" debug="on">
            <classpath>
                <pathelement location="${imported.basedir.util}/../genedb-libs/lib/biojava/biojava-1.6.jar"/>
                <pathelement location="${imported.basedir.util}/../genedb-libs/lib/spring-core-2.5.6/spring.jar"/>
            </classpath>
        </javac>

        <jar jarfile="${imported.basedir.util}/ant-build/jars/genedb-util.jar">
            <fileset dir="${imported.basedir.util}/ant-build/classes" />
            <manifest>
                <attribute name="Implementation-Title" value="GeneDB Util"/>
                <attribute name="Implementation-Version" value="0.1"/>
            </manifest>
        </jar>
    </target>

    <target name="anttasks" depends="clean-build-util,setup-util" description="Create anttasks.jar">
        <javac srcdir="${imported.basedir.util}/anttasks" destdir="${imported.basedir.util}/ant-build/anttasks-classes" debug="on">
            <classpath refid="anttasks-jars"/>
        </javac>

        <jar jarfile="${imported.basedir.util}/ant-build/jars/genedb-anttasks.jar">
            <fileset dir="${imported.basedir.util}/ant-build/anttasks-classes" />
            <manifest>
                <attribute name="Implementation-Title" value="GeneDB Ant tasks"/>
                <attribute name="Implementation-Version" value="0.1"/>
            </manifest>
        </jar>
    </target>

</project>
